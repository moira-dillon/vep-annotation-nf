def currentDirPath = new File(System.getProperty("user.dir")).getCanonicalPath()
def condaDir = "${currentDirPath}/conda/bin"
profiles {

    standard {
        docker {
            enabled = true
        }
        process {
            withName: test_vep {
                container = "stevekm:vep-96.0"
            }
        }
    }

    bigpurple {
        process {
            executor = 'slurm'
            // global process config
            // try to prevent error: module: command not found by sourcing module config, and pausing to allow environment to finish populating
            params.SLURM_vars='SLURM_JOB_ID SLURM_JOB_NAME SLURM_JOB_NODELIST SLURM_JOB_PARTITION SLURM_MEM_PER_CPU SLURM_MEM_PER_NODE SLURM_PRIO_PROCESS SLURM_SUBMIT_DIR SLURM_SUBMIT_HOST SLURM_TASK_PID SLURMD_NODENAME'
            beforeScript = """
            export PATH="${condaDir}:\$PATH";
            . /etc/profile.d/modules.sh;
            sleep 1;
            printf "USER:\${USER:-none} HOSTNAME:\${HOSTNAME:-none} PWD:\$PWD NTHREADS:\${NTHREADS:-none}\n";
            for item in ${params.SLURM_vars}; do printf "\${item}: \${!item:-none}\t"; done;
            echo "";
            TIMESTART=\$(date +%s);
            env > .env.begin;
            """
            cpus = 1
            time = '24h'
            memory = { 8.GB * task.cpus }
        }
    }
}
